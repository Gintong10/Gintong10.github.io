<!DOCTYPE html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,user-scalable=no"><title>Shadow Puppet Arena</title><style> * { margin: 0; padding: 0 } body { background: #0d0d12; color: #e0e0e0; font: 14px sans-serif; overflow: hidden; height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center } #menu { text-align: center; padding: 15px } #menu button { font-size: 16px; padding: 12px 24px; margin: 8px; border-radius: 8px; border: none; background: linear-gradient(135deg, #6a4c93, #4a2d8e); color: #fff; cursor: pointer; box-shadow: 0 4px 15px rgba(106, 76, 147, 0.4) } #menu button:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(106, 76, 147, 0.6) } #c { background: #1a1a24; border-radius: 8px; cursor: crosshair; max-width: 95vw; max-height: 50vh; border: 2px solid #333; display: none } #ui { display: none; padding: 10px; text-align: center } #ui button { font-size: 14px; padding: 8px 16px; margin: 4px; border-radius: 6px; border: none; background: #4a2d8e; color: #fff; cursor: pointer } #arena { display: none; width: 100%; flex: 1; flex-direction: column; align-items: center; padding-top: 10px } #ac { background: #1a1a24; border-radius: 8px; max-width: 100%; max-height: 60vh } .hint { font-size: 11px; color: #888; margin: 4px } #clear { background: #555 } #log { font-size: 11px; color: #aaa; max-height: 60px; overflow-y: auto; width: 90%; text-align: left; padding: 6px; background: #151520; border-radius: 6px; margin-top: 4px } #blastBtn { background: #c0392b; color: #fff; font-size: 14px; padding: 8px 16px; border: none; border-radius: 6px; margin: 4px; cursor: pointer } #blastBtn:disabled { background: #555; cursor: default } #abilityBtn { background: #9b59b6; color: #fff; font-size: 14px; padding: 8px 16px; border: none; border-radius: 6px; margin: 4px; cursor: pointer } </style></head><body><div id=menu><h1 style="background:linear-gradient(135deg,#9b59b6,#3498db);-webkit-background-clip:text;-webkit-text-fill-color:transparent;font-size:28px;margin-bottom:10px"> Shadow Puppet Arena</h1><p style="margin:8px;color:#aaa">Draw a shape. Battle AI opponents!</p><button id=start1>1 vs 1</button><button id=start3>1 vs 3</button><button id=start5>1 vs 5</button><p class=hint style="margin-top:20px">Shape affects stats: Spiky=damage, Round=tank, Long=speed</p></div><div id=ui><p id=drawStatus style="margin:4px;color:#888">Draw your monster</p><canvas id=c width=300 height=300></canvas><p class=hint>Draw in ONE stroke. Shape will auto-close.</p><button id=clear>Clear</button><button id=done>Fight!</button></div><div id=arena><canvas id=ac width=640 height=480></canvas><div style="margin:4px"><button id=blastBtn>Blast</button><button id=abilityBtn>Ability</button></div><div id=log></div><button id=restart style="background:#27ae60;color:#fff;padding:8px 16px;border:none;border-radius:6px;margin-top:8px;display:none">Play Again</button></div><script> (function () { var menu = document.getElementById('menu'), ui = document.getElementById('ui'), arena = document.getElementById('arena'), c = document.getElementById('c'), ac = document.getElementById('ac'), log = document.getElementById('log'), blastBtn = document.getElementById('blastBtn'), abilityBtn = document.getElementById('abilityBtn'), clearBtn = document.getElementById('clear'), doneBtn = document.getElementById('done'), restartBtn = document.getElementById('restart'); var W = 300, H = 300, path = [], myColor = '#6a4c93', monsters = {}, packs = [], powerups = [], hazards = [], particles = [], bounds = [0, 0, 640, 480], blastCooldown = 0, abilityCooldown = 0, blastFx = [], floatTexts = [], isDead = false, myAbility = 'none', suddenDeath = false, gameLoop = null, numBots = 3; var aiColors = ['#e74c3c', '#f39c12', '#3498db', '#2ecc71', '#e91e63']; function addLog(t) { log.innerHTML += '<div>' + t + '</div>'; log.scrollTop = log.scrollHeight } function rand(a, b) { return Math.floor(Math.random() * (b - a + 1)) + a } function genBotShape() { var p = []; var cx = 150, cy = 150, r = rand(40, 80); var pts = rand(5, 12); for (var i = 0; i < pts; i++) { var a = i / pts * Math.PI * 2; var rr = r + rand(-20, 30); p.push([Math.round((cx + Math.cos(a) * rr) / 12), Math.round((cy + Math.sin(a) * rr) / 12)]) } return p } function analyze(pts) { var corners = 0; for (var i = 2; i < pts.length; i++) { var a = Math.atan2(pts[i].y - pts[i - 1].y, pts[i].x - pts[i - 1].x), b = Math.atan2(pts[i - 1].y - pts[i - 2].y, pts[i - 1].x - pts[i - 2].x); var diff = Math.abs(a - b); if (diff > Math.PI) diff = 2 * Math.PI - diff; if (diff > 1.0) corners++ } var cx = 0, cy = 0; for (var i = 0; i < pts.length; i++) { cx += pts[i].x; cy += pts[i].y } cx /= pts.length; cy /= pts.length; var left = 0, right = 0; for (var i = 0; i < pts.length; i++) { var v = pts[i].y - cy; if (pts[i].x < cx) left += v * v; else right += v * v } var sym = Math.min(1, 1 - Math.abs(left - right) / (left + right + 1)); var segs = []; for (var i = 1; i < pts.length; i++)segs.push(Math.hypot(pts[i].x - pts[i - 1].x, pts[i].y - pts[i - 1].y)); var avg = segs.reduce(function (a, b) { return a + b }, 0) / segs.length; var legs = 0; for (var i = 0; i < segs.length; i++)if (segs[i] > avg * 1.8) legs++; return { c: corners, s: sym, l: legs } } function makeStats(p, isBot) { var pts = []; for (var i = 0; i < p.length; i++)pts.push({ x: p[i][0] * 12, y: p[i][1] * 12 }); var s = analyze(pts); var hp = rand(80, 120); var spikes = Math.min(10, s.c * 1.5); var stability = s.s * 8; var speed = 1.5 + s.l * 0.3; var ability = 'none'; if (s.c >= 5) ability = 'spike'; else if (s.s > 0.7) ability = 'absorb'; else if (s.l >= 2) ability = 'dash'; else if (s.c === 4) ability = 'block'; return { hp: hp, maxHp: hp, spikes: spikes, stability: stability, speed: speed, ability: ability } } function startGame(bots) { numBots = bots; menu.style.display = 'none'; ui.style.display = 'block'; c.style.display = 'block'; path = []; var ctx = c.getContext('2d'); ctx.fillStyle = '#1a1a24'; ctx.fillRect(0, 0, W, H); document.getElementById('drawStatus').textContent = 'Draw your monster'; document.getElementById('drawStatus').style.color = '#888' } document.getElementById('start1').onclick = function () { startGame(1) }; document.getElementById('start3').onclick = function () { startGame(3) }; document.getElementById('start5').onclick = function () { startGame(5) }; function smooth(p) { for (var k = 0; k < 2; k++) { var n = []; for (var i = 0; i < p.length; i++) { var a = p[i - 1] || p[0], b = p[i], cc = p[i + 1] || p[p.length - 1]; n.push({ x: (a.x + b.x * 2 + cc.x) / 4, y: (a.y + b.y * 2 + cc.y) / 4 }) } p = n } return p } function clamp(v, lo, hi) { return Math.max(lo, Math.min(hi, v)) } function getXY(e) { var r = c.getBoundingClientRect(), sx = W / r.width, sy = H / r.height; var px = (e.touches ? e.touches[0].clientX : e.clientX) - r.left, py = (e.touches ? e.touches[0].clientY : e.clientY) - r.top; return { x: clamp(px * sx, 5, W - 5), y: clamp(py * sy, 5, H - 5) } } function onDown(e) { var p = getXY(e); path = [p] } function onMove(e) { if (path.length === 0) return; var p = getXY(e); path.push(p); var draw = smooth(path.slice()); var ctx = c.getContext('2d'); ctx.fillStyle = '#1a1a24'; ctx.fillRect(0, 0, W, H); ctx.strokeStyle = myColor; ctx.lineWidth = 3; ctx.beginPath(); ctx.moveTo(draw[0].x, draw[0].y); for (var i = 1; i < draw.length; i++)ctx.lineTo(draw[i].x, draw[i].y); ctx.stroke(); if (draw.length > 5) { var d = Math.hypot(draw[0].x - draw[draw.length - 1].x, draw[0].y - draw[draw.length - 1].y); ctx.strokeStyle = d < 50 ? 'rgba(46,204,113,0.5)' : 'rgba(231,76,60,0.3)'; ctx.setLineDash([5, 5]); ctx.beginPath(); ctx.moveTo(draw[draw.length - 1].x, draw[draw.length - 1].y); ctx.lineTo(draw[0].x, draw[0].y); ctx.stroke(); ctx.setLineDash([]) } } function onUp() { if (path.length < 10) return; path = smooth(path); var gap = Math.hypot(path[0].x - path[path.length - 1].x, path[0].y - path[path.length - 1].y); if (gap > 5) { var steps = Math.max(2, Math.ceil(gap / 10)); var ex = path[path.length - 1].x, ey = path[path.length - 1].y; for (var i = 1; i <= steps; i++) { var t = i / steps; path.push({ x: ex * (1 - t) + path[0].x * t, y: ey * (1 - t) + path[0].y * t }) } } path.push({ x: path[0].x, y: path[0].y }); document.getElementById('drawStatus').textContent = 'Shape ready!'; document.getElementById('drawStatus').style.color = '#2ecc71'; drawMonster() } function drawMonster() { var ctx = c.getContext('2d'), pts = path; if (pts.length < 3) return; ctx.fillStyle = '#1a1a24'; ctx.fillRect(0, 0, W, H); ctx.fillStyle = myColor; ctx.beginPath(); ctx.moveTo(pts[0].x, pts[0].y); for (var i = 1; i < pts.length; i++)ctx.lineTo(pts[i].x, pts[i].y); ctx.closePath(); ctx.fill('evenodd') } c.addEventListener('touchstart', function (e) { e.preventDefault(); onDown(e) }); c.addEventListener('touchmove', function (e) { e.preventDefault(); onMove(e) }); c.addEventListener('touchend', function (e) { e.preventDefault(); if (e.touches.length === 0) onUp() }); c.addEventListener('mousedown', onDown); c.addEventListener('mousemove', function (e) { if (e.buttons) onMove(e) }); c.addEventListener('mouseup', onUp); clearBtn.onclick = function () { path = []; var ctx = c.getContext('2d'); ctx.fillStyle = '#1a1a24'; ctx.fillRect(0, 0, W, H); document.getElementById('drawStatus').textContent = 'Draw your monster'; document.getElementById('drawStatus').style.color = '#888' }; doneBtn.onclick = function () { if (path.length < 10) { document.getElementById('drawStatus').textContent = 'Draw a shape first!'; document.getElementById('drawStatus').style.color = '#e66'; return } var mx = 1e9, my = 1e9, Mx = 0, My = 0; for (var i = 0; i < path.length; i++) { mx = Math.min(mx, path[i].x); my = Math.min(my, path[i].y); Mx = Math.max(Mx, path[i].x); My = Math.max(My, path[i].y) } var sw = Mx - mx || 1, sh = My - my || 1, sc = Math.min(220 / sw, 220 / sh), ox = 150 - (mx + Mx) / 2 * sc, oy = 150 - (my + My) / 2 * sc; var p = []; var ns = Math.min(path.length, 20); for (var i = 0; i < ns; i++) { var j = Math.floor(i * (path.length - 1) / (ns - 1)); p.push([Math.round((path[j].x * sc + ox) / 12), Math.round((path[j].y * sc + oy) / 12)]) } initArena(p) }; function initArena(playerPath) { ui.style.display = 'none'; arena.style.display = 'flex'; restartBtn.style.display = 'none'; log.innerHTML = ''; monsters = {}; packs = []; powerups = []; hazards = []; particles = []; blastFx = []; floatTexts = []; bounds = [0, 0, 640, 480]; suddenDeath = false; isDead = false; blastCooldown = 0; abilityCooldown = 0; var ps = makeStats(playerPath, false); monsters[0] = { id: 0, x: 320, y: 400, vx: 0, vy: 0, path: playerPath, color: myColor, hp: ps.hp, maxHp: ps.maxHp, spikes: ps.spikes, stability: ps.stability, speed: ps.speed, ability: ps.ability, size: 35, name: 'You', effects: {}, trail: [], target: null }; myAbility = ps.ability; abilityBtn.textContent = myAbility === 'none' ? 'No Ability' : myAbility.charAt(0).toUpperCase() + myAbility.slice(1); for (var i = 0; i < numBots; i++) { var bp = genBotShape(); var bs = makeStats(bp, true); var bx = 100 + i * 150; var by = 80 + rand(-20, 20); monsters[i + 1] = { id: i + 1, x: bx, y: by, vx: 0, vy: 0, path: bp, color: aiColors[i % 5], hp: bs.hp, maxHp: bs.maxHp, spikes: bs.spikes, stability: bs.stability, speed: bs.speed, ability: bs.ability, size: 30, name: 'Bot' + (i + 1), effects: {}, trail: [], target: 0, aiTimer: 0 } } addLog('Battle started! ' + numBots + ' bots vs you!'); blastBtn.disabled = false; blastBtn.textContent = 'Blast'; blastBtn.style.background = '#c0392b'; abilityBtn.disabled = false; abilityBtn.style.background = '#9b59b6'; if (gameLoop) clearInterval(gameLoop); gameLoop = setInterval(update, 16) } function update() { var alive = []; for (var id in monsters) if (monsters[id].hp > 0) alive.push(id); if (alive.length <= 1) { clearInterval(gameLoop); restartBtn.style.display = 'inline-block'; if (monsters[0] && monsters[0].hp > 0) addLog('ðŸ† You win!'); else addLog('ðŸ’€ Game over!'); return } if (!suddenDeath && Date.now() % 30000 < 16 && bounds[0] < 100) { suddenDeath = true; addLog('âš¡ Sudden Death! Arena shrinking!') } if (suddenDeath) { bounds[0] += 0.02; bounds[1] += 0.02; bounds[2] -= 0.02; bounds[3] -= 0.02 } if (Math.random() < 0.003 && packs.length < 3) packs.push({ x: rand(bounds[0] + 50, bounds[2] - 50), y: rand(bounds[1] + 50, bounds[3] - 50), hp: 20 }); if (Math.random() < 0.002 && powerups.length < 2) { var types = ['speed', 'shield', 'damage', 'ghost']; powerups.push({ x: rand(bounds[0] + 50, bounds[2] - 50), y: rand(bounds[1] + 50, bounds[3] - 50), type: types[rand(0, 3)] }) } for (var id in monsters) { var m = monsters[id]; if (m.hp <= 0) continue; m.trail.push({ x: m.x, y: m.y }); if (m.trail.length > 8) m.trail.shift(); if (id > 0) { var t = monsters[m.target]; if (!t || t.hp <= 0) { for (var tid in monsters) if (tid != id && monsters[tid].hp > 0) { m.target = tid; break } } t = monsters[m.target]; if (t && t.hp > 0) { var dx = t.x - m.x, dy = t.y - m.y, d = Math.hypot(dx, dy); if (d > 5) { m.vx += (dx / d) * m.speed * 0.15; m.vy += (dy / d) * m.speed * 0.15 } } if (m.aiTimer <= 0 && Math.random() < 0.02) { m.aiTimer = 60; if (m.ability !== 'none' && Math.random() < 0.3) useAbility(id) } } m.vx *= 0.96; m.vy *= 0.96; m.x += m.vx; m.y += m.vy; m.x = clamp(m.x, bounds[0] + m.size, bounds[2] - m.size); m.y = clamp(m.y, bounds[1] + m.size, bounds[3] - m.size); if (m.x <= bounds[0] + m.size || m.x >= bounds[2] - m.size) m.vx *= -0.5; if (m.y <= bounds[1] + m.size || m.y >= bounds[3] - m.size) m.vy *= -0.5; if (suddenDeath && (m.x <= bounds[0] + m.size + 5 || m.x >= bounds[2] - m.size - 5 || m.y <= bounds[1] + m.size + 5 || m.y >= bounds[3] - m.size - 5)) { m.hp -= 0.5; floatTexts.push({ x: m.x, y: m.y - 20, text: '-1', color: '#f00', age: 0 }) } if (m.aiTimer > 0) m.aiTimer--; for (var eid in m.effects) if (m.effects[eid] > 0) m.effects[eid]--; else delete m.effects[eid] } for (var i = 0; i < alive.length; i++) { for (var j = i + 1; j < alive.length; j++) { var a = monsters[alive[i]], b = monsters[alive[j]]; var dx = b.x - a.x, dy = b.y - a.y, d = Math.hypot(dx, dy); var minD = a.size + b.size; if (d < minD && d > 0) { var nx = dx / d, ny = dy / d; var overlap = (minD - d) / 2; a.x -= nx * overlap; a.y -= ny * overlap; b.x += nx * overlap; b.y += ny * overlap; var rv = (a.vx - b.vx) * nx + (a.vy - b.vy) * ny; a.vx -= rv * nx * 0.5; a.vy -= rv * ny * 0.5; b.vx += rv * nx * 0.5; b.vy += rv * ny * 0.5; var va = Math.hypot(a.vx, a.vy), vb = Math.hypot(b.vx, b.vy); var velBonus = Math.max(0, (va + vb - 3) * 2); if (!b.effects.shield) { var dmgA = Math.max(1, a.spikes - b.stability * 0.5 + velBonus); b.hp -= dmgA; floatTexts.push({ x: b.x, y: b.y - 20, text: '-' + Math.round(dmgA), color: '#ff6b6b', age: 0 }); if (a.ability === 'absorb') { a.hp = Math.min(a.maxHp, a.hp + dmgA * 0.5) } } if (!a.effects.shield) { var dmgB = Math.max(1, b.spikes - a.stability * 0.5 + velBonus); a.hp -= dmgB; floatTexts.push({ x: a.x, y: a.y - 20, text: '-' + Math.round(dmgB), color: '#ff6b6b', age: 0 }); if (b.ability === 'absorb') { b.hp = Math.min(b.maxHp, b.hp + dmgB * 0.5) } } } } } for (var id in monsters) { var m = monsters[id]; if (m.hp <= 0) continue; for (var pi = packs.length - 1; pi >= 0; pi--) { var pk = packs[pi]; if (Math.hypot(m.x - pk.x, m.y - pk.y) < m.size + 10) { m.hp = Math.min(m.maxHp, m.hp + pk.hp); floatTexts.push({ x: m.x, y: m.y - 20, text: '+' + pk.hp, color: '#2ecc71', age: 0 }); packs.splice(pi, 1) } } for (var pi = powerups.length - 1; pi >= 0; pi--) { var pu = powerups[pi]; if (Math.hypot(m.x - pu.x, m.y - pu.y) < m.size + 12) { m.effects[pu.type] = pu.type === 'shield' ? 180 : pu.type === 'ghost' ? 240 : 300; addLog(m.name + ' got ' + pu.type + '!'); powerups.splice(pi, 1) } } } for (var id in monsters) { if (monsters[id].hp <= 0 && !monsters[id].dead) { monsters[id].dead = true; addLog('ðŸ’€ ' + monsters[id].name + ' eliminated!'); for (var k = 0; k < 15; k++) { particles.push({ x: monsters[id].x + rand(-20, 20), y: monsters[id].y + rand(-20, 20), vx: rand(-3, 3), vy: rand(-3, 3), color: monsters[id].color, age: 0 }) } if (id == 0) { isDead = true; blastBtn.disabled = true; blastBtn.textContent = 'Dead'; abilityBtn.disabled = true; abilityBtn.textContent = 'Dead' } } } for (var pi = particles.length - 1; pi >= 0; pi--) { var p = particles[pi]; p.x += p.vx; p.y += p.vy; p.age++; if (p.age > 30) particles.splice(pi, 1) } render() } function useAbility(id) { var m = monsters[id]; if (!m || m.hp <= 0) return; if (m.ability === 'spike') { for (var eid in monsters) { if (eid != id && monsters[eid].hp > 0) { var e = monsters[eid]; if (Math.hypot(e.x - m.x, e.y - m.y) < 80) { e.hp -= 20; floatTexts.push({ x: e.x, y: e.y - 20, text: '-20', color: '#ff0', age: 0 }) } } } addLog(m.name + ' used Spike Burst!') } else if (m.ability === 'dash') { var t = monsters[m.target]; if (t && t.hp > 0) { var dx = t.x - m.x, dy = t.y - m.y, d = Math.hypot(dx, dy); if (d > 0) { m.vx += (dx / d) * 15; m.vy += (dy / d) * 15 } } addLog(m.name + ' used Dash!') } else if (m.ability === 'block') { m.effects.shield = 180; addLog(m.name + ' used Block!') } } blastBtn.onclick = function () { if (blastCooldown > 0 || isDead) return; var m = monsters[0]; if (!m) return; blastFx.push({ x: m.x, y: m.y, age: 0 }); for (var id in monsters) { if (id == 0) continue; var e = monsters[id]; var dx = e.x - m.x, dy = e.y - m.y, d = Math.hypot(dx, dy); if (d < 100 && d > 0) { var f = 80 / d; e.vx += (dx / d) * f; e.vy += (dy / d) * f } } blastCooldown = 600; blastBtn.disabled = true; blastBtn.textContent = '10s'; var cd = setInterval(function () { blastCooldown -= 60; if (blastCooldown <= 0) { clearInterval(cd); if (!isDead) { blastBtn.disabled = false; blastBtn.textContent = 'Blast'; blastBtn.style.background = '#c0392b' } } else { blastBtn.textContent = Math.ceil(blastCooldown / 60) + 's' } }, 1000) }; abilityBtn.onclick = function () { if (abilityCooldown > 0 || isDead || myAbility === 'none') return; useAbility(0); abilityCooldown = 600; abilityBtn.disabled = true; abilityBtn.textContent = '10s'; var cd = setInterval(function () { abilityCooldown -= 60; if (abilityCooldown <= 0) { clearInterval(cd); if (!isDead) { abilityBtn.disabled = false; abilityBtn.textContent = myAbility.charAt(0).toUpperCase() + myAbility.slice(1); abilityBtn.style.background = '#9b59b6' } } else { abilityBtn.textContent = Math.ceil(abilityCooldown / 60) + 's' } }, 1000) }; function render() { var ctx = ac.getContext('2d'); ctx.fillStyle = '#180818'; ctx.fillRect(0, 0, 640, 480); ctx.fillStyle = '#0d0d12'; ctx.fillRect(bounds[0], bounds[1], bounds[2] - bounds[0], bounds[3] - bounds[1]); var isShrunk = bounds[0] > 0; ctx.strokeStyle = isShrunk ? '#ff0000' : '#555'; ctx.lineWidth = isShrunk ? 4 : 2; ctx.strokeRect(bounds[0], bounds[1], bounds[2] - bounds[0], bounds[3] - bounds[1]); for (var pi = 0; pi < packs.length; pi++) { var pk = packs[pi]; ctx.fillStyle = '#2ecc71'; ctx.beginPath(); ctx.arc(pk.x, pk.y, 10, 0, Math.PI * 2); ctx.fill(); ctx.fillStyle = '#fff'; ctx.fillRect(pk.x - 6, pk.y - 2, 12, 4); ctx.fillRect(pk.x - 2, pk.y - 6, 4, 12) } var puColors = { speed: '#ff0', shield: '#08f', damage: '#f00', ghost: '#aaa' }; for (var pi = 0; pi < powerups.length; pi++) { var pu = powerups[pi]; ctx.fillStyle = puColors[pu.type] || '#fff'; ctx.beginPath(); ctx.arc(pu.x, pu.y, 12, 0, Math.PI * 2); ctx.fill() } for (var id in monsters) { var m = monsters[id]; if (!m.path || !m.path.length || m.hp <= 0) continue; var sc = m.size / 40; var pcx = 0, pcy = 0; for (var i = 0; i < m.path.length; i++) { pcx += m.path[i][0] * 12; pcy += m.path[i][1] * 12 } pcx /= m.path.length; pcy /= m.path.length; if (m.trail && m.trail.length > 1) { for (var ti = 0; ti < m.trail.length - 1; ti++) { var alpha = (ti / m.trail.length) * 0.4; ctx.globalAlpha = alpha; ctx.fillStyle = m.color; ctx.beginPath(); ctx.arc(m.trail[ti].x, m.trail[ti].y, m.size * 0.3 * (ti / m.trail.length), 0, Math.PI * 2); ctx.fill() } ctx.globalAlpha = 1 } if (m.effects && (m.effects.speed || m.effects.shield || m.effects.damage || m.effects.ghost)) { ctx.save(); ctx.globalAlpha = 0.4; ctx.fillStyle = m.effects.shield ? '#08f' : m.effects.speed ? '#ff0' : m.effects.damage ? '#f00' : '#aaa'; ctx.beginPath(); ctx.arc(m.x, m.y, m.size + 10, 0, Math.PI * 2); ctx.fill(); ctx.restore() } ctx.save(); ctx.translate(m.x, m.y); ctx.scale(sc, sc); ctx.fillStyle = m.effects && m.effects.ghost ? 'rgba(255,255,255,0.3)' : m.color; ctx.beginPath(); ctx.moveTo((m.path[0][0] * 12 - pcx), (m.path[0][1] * 12 - pcy)); for (var i = 1; i < m.path.length; i++)ctx.lineTo((m.path[i][0] * 12 - pcx), (m.path[i][1] * 12 - pcy)); ctx.closePath(); ctx.fill('evenodd'); ctx.restore(); ctx.fillStyle = '#fff'; ctx.font = 'bold ' + Math.max(10, Math.round(12 * sc)) + 'px sans-serif'; ctx.textAlign = 'center'; ctx.textBaseline = 'middle'; ctx.fillText(Math.ceil(m.hp), m.x, m.y); if (m.name) { ctx.font = Math.max(9, Math.round(10 * sc)) + 'px sans-serif'; ctx.fillText(m.name, m.x, m.y - m.size * 1.5 - 6) } } for (var pi = 0; pi < particles.length; pi++) { var p = particles[pi]; var alpha = Math.max(0, 1 - p.age / 30); ctx.globalAlpha = alpha; ctx.fillStyle = p.color; ctx.beginPath(); ctx.arc(p.x, p.y, 4, 0, Math.PI * 2); ctx.fill() } ctx.globalAlpha = 1; for (var bi = blastFx.length - 1; bi >= 0; bi--) { var bf = blastFx[bi]; bf.age++; var r = bf.age * 4; var alpha = Math.max(0, 1 - bf.age / 20); ctx.strokeStyle = 'rgba(255,255,255,' + alpha + ')'; ctx.lineWidth = Math.max(1, 4 - bf.age * 0.15); ctx.beginPath(); ctx.arc(bf.x, bf.y, r, 0, Math.PI * 2); ctx.stroke(); if (bf.age > 20) blastFx.splice(bi, 1) } for (var fi = floatTexts.length - 1; fi >= 0; fi--) { var ft = floatTexts[fi]; ft.age++; ctx.globalAlpha = Math.max(0, 1 - ft.age / 40); ctx.fillStyle = ft.color; ctx.font = 'bold 14px sans-serif'; ctx.textAlign = 'center'; ctx.fillText(ft.text, ft.x, ft.y - ft.age * 0.8); ctx.globalAlpha = 1; if (ft.age > 40) floatTexts.splice(fi, 1) } } restartBtn.onclick = function () { arena.style.display = 'none'; menu.style.display = 'block' }; var keys = {}; document.addEventListener('keydown', function (e) { keys[e.key] = true }); document.addEventListener('keyup', function (e) { keys[e.key] = false }); setInterval(function () { if (!monsters[0] || monsters[0].hp <= 0) return; var m = monsters[0]; var sp = m.speed * (m.effects.speed ? 2 : 1); if (keys.ArrowUp || keys.w || keys.W) m.vy -= sp * 0.3; if (keys.ArrowDown || keys.s || keys.S) m.vy += sp * 0.3; if (keys.ArrowLeft || keys.a || keys.A) m.vx -= sp * 0.3; if (keys.ArrowRight || keys.d || keys.D) m.vx += sp * 0.3; if (keys[' '] && blastCooldown <= 0) blastBtn.click() }, 16); ac.addEventListener('touchstart', function (e) { e.preventDefault() }); ac.addEventListener('touchmove', function (e) { e.preventDefault(); if (!monsters[0] || monsters[0].hp <= 0) return; var r = ac.getBoundingClientRect(); var tx = (e.touches[0].clientX - r.left) / (r.width) * 640; var ty = (e.touches[0].clientY - r.top) / (r.height) * 480; var m = monsters[0]; var dx = tx - m.x, dy = ty - m.y, d = Math.hypot(dx, dy); if (d > 10) { var sp = m.speed * (m.effects.speed ? 2 : 1); m.vx += (dx / d) * sp * 0.4; m.vy += (dy / d) * sp * 0.4 } }) })(); </script></body></html>
